!function(){"use strict";var C,I,t=window.tabId,h=window.Tabs[t],M=$("#products-list-container"),q=M.find("#products-list-results"),A=M.find("#load-products"),S=window.i18n,s=function(){C=h.data,I=C.hits.hits.map(function(t){return Object.assign({_id:t._id},t._source)})};if(s(),console.log(I),I.length){var O="/"+window.location.hash+"/",i="",T=[],j=0,P=-1,N=0,r={},l=!1,g=function(t,a,e){if(!l){var n;""!==i?(n={bool:{must:{multi_match:{query:i,fields:["name","keywords"]}}}},T.length&&(n.bool.filter=T)):T.length&&(n={bool:{filter:T}});e||M.addClass("ajax"),t?j++:(j=0,P=-1),l=!0,h.load(function(){l=!1,"function"!=typeof e?(s(),u()):e()},n,r,j,a)}};A.click(function(){g(!0)}),h.pagination=function(t){g(!t)};var F=$("<div>"),D=$("<form>",{action:"javascript:;",submit:g,html:['<div class="form-group"><input class="form-control text-monospace" placeholder="SKU" type="text" name="sku" data-filter="term"/></div>',F,'<label class="i18n"><span data-lang="en_us">Price</span><span data-lang="pt_br">Preço</span></label><div class="flexbox"><div class="form-group"><input class="form-control" type="tel" name="price" data-opt="gte" data-filter="range" data-is-number="true" data-money="true"/><small class="form-text i18n"><span data-lang="en_us">Minimun</span><span data-lang="pt_br">Mínimo</span></small></div><div class="form-group"><input class="form-control" type="tel" name="price" data-opt="lte" data-filter="range" data-is-number="true" data-money="true"/><small class="form-text i18n"><span data-lang="en_us">Maximum</span><span data-lang="pt_br">Máximo</span></small></div></div><label class="i18n"><span data-lang="en_us">Quantity</span><span data-lang="pt_br">Quantidade</span></label><div class="flexbox"><div class="form-group"><input class="form-control" type="number" name="quantity" data-opt="gte" data-filter="range" data-is-number="true"/><small class="form-text i18n"><span data-lang="en_us">Minimun</span><span data-lang="pt_br">Mínimo</span></small></div><div class="form-group"><input class="form-control" type="number" name="quantity" data-opt="lte" data-filter="range" data-is-number="true"/><small class="form-text i18n"><span data-lang="en_us">Maximum</span><span data-lang="pt_br">Máximo</span></small></div></div>']}),a=function(){T=[],g()};M.find("#clear-products-filters").click(a);var e=$("#qvx");e.find("#qvx-title").text(S({en_us:"Filter products",pt_br:"Filtrar produtos"}));var n=$("#modal-center");n.find("input[data-money]").inputMoney();var b=$("#startDate"),_=$("#endDate"),o=$("#setCategory"),c=$("#saveModalCat"),d=$("#categoryMass");o.click(function(){window.callApi("categories.json","GET",function(t,a){if(!t)for(var e,n=0;n<a.result.length;n++){e=$("<option />",{text:a.result[n].name,value:(a.result[n],JSON.stringify({_id:a.result[n]._id}))}),d.append(e).selectpicker("refresh").trigger("change")}})}),c.click(function(){for(var t=d.val(),e=h.selectedItems,a=0;a<e.length;a++)for(var n=0;n<t.length;n++){var s=JSON.parse(t[n]),i=0;window.callApi("products/"+e[a]+"/categories.json","POST",function(t,a){t||(i++,e.length===i?($("#modal-center-1").modal("hide"),app.toast(S({en_us:"Completed edit",pt_br:"Categoria inserida com sucesso"})),$("#spinner-wait").hide(),g()):$("#spinner-wait").show())},s)}});var y=(new Date).getTimezoneOffset();"pt_br"===window.lang?(b.inputmask("99/99/9999"),_.inputmask("99/99/9999")):(b.inputmask("9999-99-99"),_.inputmask("9999-99-99"));var w=$("#priceToSell"),x=$("#quantityFixed"),p=$("#products-bulk-action");p.find(".edit-selected").click(function(){0<!h.selectedItems.length?(console.log(h.selectedItems),app.toast(S({en_us:"No items selected",pt_br:"Nenhum item selecionado"}))):p.find("button").attr("data-toggle","dropdown")}),n.find("#saveModal").click(function(){var t=h.selectedItems;if(t)for(var a=0;a<t.length;a++){var v=0;window.callApi("products/"+t[a]+".json","GET",function(t,a){if(t)console.log(t);else{var e,n,s;s={},a.base_price?e=a.base_price:(e=a.price,s.base_price=a.price);var i=a.quantity,r=(e-e*($("#discountSell").val()/100)).toFixed(2),l=w.val().replace("R$","").replace(",",".").trim(),o=parseFloat(l);s.price=o||parseFloat(r);var c=x.val();if(c&&(n=c,s.quantity=n),a.quantity&&(n=parseInt(i),s.quantity=n),b.val()||_.val()){if(s.price_effective_date={},b.val()){var d=b.val().split("/"),p=new Date(parseInt(d[2]),parseInt(d[1])-1,parseInt(d[0]),0,-y,0,0).toISOString();s.price_effective_date.start=p}if(_.val()){var u=_.val().split("/"),m=new Date(parseInt(u[2]),parseInt(u[1])-1,parseInt(u[0]),0,-y,0,0).toISOString();s.price_effective_date.end=m}}var f=function(t,a){t||(v++,h.selectedItems.length===v?(app.toast(S({en_us:"Completed edit",pt_br:"Edição em massa completa"})),$("#spinner-wait-edit").hide(),$("#modal-center").modal("hide"),g()):$("#spinner-wait-edit").show())};setTimeout(function(){window.callApi("products/"+a._id+".json","PATCH",f,s)},500)}})}}),n.find(".modal-title").text(S({pt_br:"Editar em massa",en_us:"Mass edit"})),e.find("#qvx-body").html(D),e.find("#qvx-footer").html([$("<button>",{class:"btn btn-success mr-2",click:function(){g(),quickview.close(e)},html:S({en_us:"Apply filters",pt_br:"Aplicar filtros"})}),$("<button>",{class:"btn btn-warning",click:function(){a(),quickview.close(e)},html:S({en_us:"Clear",pt_br:"Limpar"})})]);var E=function(a,e,t,n){n.on("change",function(){$(this).is(":checked")?h.selectedItems.push(a):h.selectedItems=$.grep(h.selectedItems,function(t){return t!==a})}),t.click(function(){h.state.page=e,h.state.pagination=function(t){-1<(e+=t?-1:1)&&(h.state.page=e,j=e-1,g(!0,1,function(){var t=h.data.hits.hits[0];t&&(window.location=O+t._id)}))}})},u=function(){for(var t=[],a=I.length,e=C.hits.total,n=C.aggregations,s=0;s<a;s++){P++;var i,r,l=I[s],o=O+l._id;i=l.price?formatMoney(l.price,l.currency_id):S({en_us:"No price",pt_br:"Sem preço"}),r=l.quantity?l.quantity+" un":"∞";var c="";if(l.pictures&&l.pictures.length){var d=l.pictures[0],p=d.small;if(!p)for(var u in d)if(d.hasOwnProperty(u)&&"_id"!==u){p=d[u];break}p&&(c='<img src="'+p.url+'">')}var m=$("<input>",{class:"custom-control-input",type:"checkbox"}),f=$("<div>",{class:"col item-product",html:['<a href="'+o+'" class="item-picture">'+c+'</a><div class="item-info"><a href="'+o+'">'+l.name+'</a><div class="item-price">'+i+'</div><span class="text-muted"><i class="mr-2 fa fa-'+(l.visible?"eye":"eye-slash")+'"></i><i class="mr-2 fa fa-'+(l.available?"check":"close")+'"></i></span><span class="item-qnt">'+r+"</span></div>",$("<div>",{class:"custom-controls-stacked",html:$("<div>",{class:"custom-control custom-checkbox",html:[m,$("<label>",{class:"custom-control-label",html:'<span class="item-sku">'+l.sku+"</span>"})]})})]});t.push(f),E(l._id,P,f,m)}0===j?0<e?q.html($("<div>",{class:"row row-products",html:t})):q.html(""):q.children(".row").append(t),a<e?(A.removeAttr("disabled"),0===j&&(N=a)):A.attr("disabled",!0);var v=M.find("#products-list-info");if(0===e)v.hide();else{v.show(),v.find("#products-list-count").text(N*j+a),v.find("#products-list-total").text(e);var h=v.find("#products-avg-price");n.avg_price.value?h.text(formatMoney(n.avg_price.value)+" ("+formatMoney(n.min_price.value)+" - "+formatMoney(n.max_price.value)+")"):h.text(" ~ ")}F.html("");var g={"brands.name":{label:S({en_us:"Brands",pt_br:"Marcas"})},"categories.name":{label:S({en_us:"Categories",pt_br:"Categorias"})},status:{label:"Status"}};for(var b in g)if(g.hasOwnProperty(b)&&n.hasOwnProperty(b)){var _=g[b],y=n[b].buckets;if(y.length){var w="";for(s=0;s<y.length;s++){var x=y[s].key;w+='<option value="'+x+'" data-subtext="('+y[s].doc_count+')">'+x+"</option>"}var k=$("<select />",{multiple:!0,"data-live-search":!0,class:"form-control",name:b,html:w});F.prepend($("<div />",{class:"form-group selectpicker-default",html:k})),k.selectpicker({style:"btn-light",noneSelectedText:_.label,windowPadding:70})}}M.removeClass("ajax"),handleInputs(D,function(t,a){var e=t.attr("name"),n=t.data("opt"),s=t.data("filter")||"terms",i=t.val();console.log(!Array.isArray(i)),Array.isArray(i)?i.length||(i=null):(i=t.data("is-number")?stringToNumber(i):"number"===t.attr("type")?parseFloat(i):i.trim(),isNaN(i)&""===i&&(i=null));for(var r=0;r<T.length;r++){var l=T[r][s];if(l&&l.hasOwnProperty(e))return void(n?null!==i?l[e][n]=i:(delete l[e][n],Object.keys(l[e]).length||T.splice(r,1)):null!==i?l[e]=i:T.splice(r,1))}if(null!==i){var o={};o[s]={},n?(o[s][e]={},o[s][e][n]=i):o[s][e]=i,T.push(o)}})},m=M.find("#search-products"),f=m.find("input");f.attr("placeholder",S({en_us:"Polo Shirt",pt_br:"Camisa Polo"})),m.submit(function(){i=f.val().trim(),g()}),M.find("#order-products a").click(function(){var t,a={desc:"fa-caret-down text-warning",asc:"fa-caret-up text-info"};if($(this).hasClass("active")){var e=$(this).data("sort");t="desc"===e?"asc":"desc",$(this).data("sort",t).find("i").removeClass(a[e]).addClass(a[t])}else t="desc",$(this).parent().children(".active").removeClass("active").removeData("sort").find("i").remove(),$(this).addClass("active").data("sort",t).append($("<i>",{class:"ml-1 fa "+a.desc}));(r={})[$(this).data("field")]={order:t},g()}),h.editItemsCallback=function(){return M.addClass("ajax"),function(t){Array.isArray(t)&&!t.length?q.find("input:checked").closest(".item-product").fadeOut(400,function(){M.removeClass("ajax")}):g()}},$("#select-all-products").on("change",function(){var t=$(this).is(":checked")?":not(:checked)":":checked";return q.find('input[type="checkbox"]'+t).each(function(t){var a=$(this);setTimeout(function(){a.next().click()},20*t)}),!0}),u()}setTimeout(function(){window.unsetSaveAction()},200)}();